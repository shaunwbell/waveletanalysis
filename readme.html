<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<style>
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>
<title>Requirements to run analysis again</title>
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax:{inlineMath:[['$$$','$$$']]}});</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<h2>Wavelet Analysis (CWT):</h2>

<h5>Requirements to run analysis again</h5>

<ul>
<li>Wavelet Analysis Routine <a href="https://github.com/aaren/wavelets">https://github.com/aaren/wavelets</a> (modifications have been made to calculate significance contours - the original package is not in this repository)</li>
<li>brewer2mpl for colormaps <a href="https://github.com/jiffyclub/brewer2mpl">https://github.com/jiffyclub/brewer2mpl</a></li>
<li>Standard scientific packages (scipy, numpy, matplotlib) - scipy is used for autogression coefs and inverse chi_squared test</li>
<li>User writen wave_signif module modeled after matlab code from Univ Colorado</li>
</ul>


<h4>Following a couple of different sources:</h4>

<ul>
<li><p><a href="http://paos.colorado.edu/research/wavelets/">Univ Colorado wavelet page</a> with Matlab Routines and examples. <br/>
These where used for guidance in visualization as well as modifying code to compute the 95% confidence interval.</p></li>
<li><p>As well as a <strong>Wavelets.py</strong> "A Clean Python implementation of the wavelet analysis outlined in <a href="http://paos.colorado.edu/research/wavelets/bams_79_01_0061.pdf">Torrence
  and Compo</a> (BAMS, 1998)" from <a href="https://github.com/aaren/wavelets">https://github.com/aaren/wavelets</a></p></li>
<li><p>Python has <a href="https://pypi.python.org/pypi/PyWavelets/">PyWavelets</a> (for more complex transforms than I implemented)</p></li>
</ul>


<h4>Basic Implementation of <strong>Wavelets.py</strong></h4>

<p>Perform Wavelet Transform on normalized data with variance = 1.0.
Intrinsically pads with zeros for FFT</p>

<pre><code>After ingesting data from source (.txt, .nc, etc)
# normalize data

wa = WaveletAnalysis(x, time=time, dt=dt, dj=0.125) #dj should by dt/2

# wavelet power spectrum
power = wa.wavelet_power
transform = wa.wavelet_transform

# scales 
scales = wa.scales

# associated time vector
t = wa.time

# reconstruction of the original data
rx = wa.reconstruction()

--
# determine acor factor for red noise
acorr = acf(x) # &lt;-- subroutine using scipy
lagf = (acorr[1]+np.sqrt(acorr[2]))/2
print lagf

# determine contour locations for significance levels at 95%
(signif, fft_theory) = wave_sig.wave_signif(x,dt,scales,lag1=lagf) # &lt;-- subroutine modeled after matlab    sig95 = np.ones_like(power) * np.array([signif] * len(t)).transpose()
sig95 = power / sig95         # where ratio &gt; 1, power is significant

# plot however you see fit
</code></pre>

<h4>Plotting</h4>

<p>Plotting the powerspectrum as a function of scales (log2 base due to implicit FFT) and time. <br/>
Using Nino3SST seasonal anomalies from the Univ of Colorado matlab code.  <br/>
If plotting normalized data with Variance Contours (like TC_98 fig2a)</p>

<p><img src="images/normalizeddata/Nino3SST_varcont_wave2.png" alt="Variance Contoured" width=100%></p>

<p>If plotting normalized data with quartile contours (like wavelet website)</p>

<p><img src="images/normalizeddata/Nino3SST_wave2.png" alt="Quartile Contoured" width=100%></p>

<h5>General Comments</h5>

<pre><code>Contour levels in BAMS are at normalized variances of 1, 2, 5, 10 ??? (fig2b)   

Contour levels on web chosen to represent where 5%, 25%, 50%, 75% of wavelet
power values are (eg. 95% of data is greater than a value, 1st quartile, median
and 3rd quartile)
</code></pre>

<p>All data is normalized when plotted as wavelet power spectra (and is the power relative to white noise if power/sigma^2 or if data is normalized and sigma^2 = 1)</p>

<p>The variance listed in fig2b from TC_98 is the dataset variance.  Normalizing data by this value gives a normalized power spectrum. Contouring along [0,1,2,5,10] power/variance contours gives equivalent plots.</p>

<p>If instead of using variance contours the data is contoured at quartiles, then the output matches web source.  (power does not need to be plotted as log2 as matlab code suggests).</p>

<p>For Nino3SST - compared against red-noise spectrum with AR1 lag of .72 (as in TC_98) and is determined by an autocorrelation subroutine in the analysis code that finds <code>lag1 = (alpha1 + sqrt(alpha2))/2</code></p>

<h5>Questions/Issues/Concerns</h5>

<p>In order to asthetically and scientifically display the contour maps, I've been battling among different colormap schemes: Colormap choice - <code>hot_r</code> vs <code>Greens or Blues</code> vs <code>jet</code> Its a question of being asthetic (jet is not in my opinon), potentially good for b/w printing (also not jet) and yet informative even when values are not significant.</p>

<p>Possible inconsistency in programming from siteâ€¦ Matlab routine and IDL routines are not equivalent.  <del>Web output may vary slightly as it indicates it is using IDL.  (eg. significance is based on global wavelet spectrum, not red noise and at confidence int of .9)</del></p>

<h2>M_6 Mooring</h2>

<p>Data Source = 03sg5j_0114m_detide_f35.nc</p>

<p>The top pannels are the anomaly timeseries (red) and the reconstructed wavelet analysis timeseries (blue) with the differences plotted in black. The right panel is the global time-averaged power in blue with the 95% confidence line plotted as a black dashed line.</p>

<p><img src="images/normalizeddata/M6_P_1_wave2.png" alt="M6_Quartile Contoured" width=100%></p>

<p>Normalized data.   The bottom panel is the wavelet power with the contour intervals at quartiles [0, .25. .50, .75, .95]. 95% Confidence Interval is contoured against a rednoise spectrum of alpha=.987 from <code>lag1 = (alpha1 + sqrt(alpha2))/2</code>.</p>

<p><img src="images/normalizeddata/M6_P_1_varcont_wave2.png" alt="M6_variance_cont" width=100%></p>

<p>Normalized data.  The bottom panel is the wavelet power with the contour intervals at power/variance levels [0,1,2,5,10].  95% Confidence Interval is contoured against a rednoise spectrum of alpha=.987</p>

<h5>For fun I plotted the original data which wasn't detided</h5>

<p><img src="images/normalizeddata/M6_P_1wtide_wave2.png" alt="M6_Quartile Contoured w/tides" width=100%></p>

<p>As expected, The daily and semi-daily tides dominate the signal.  The contours are quartile contours.</p>

<h5>Questions/Issues/Concerns</h5>

<p>When using ones own dataset, the online analysis does <strong>not</strong> normalize the data (this can be seen in the timeseries plot).  The wavelet analysis is consistant with unnormalized data (contour plot) but the global wavelet analysis seems to be using a variance of 1 (comparing magnitudes) perhaps it is assumed my data is normalized.  It does seem to auto calculate the ar1 coef. properly.  If I provide normalized data, the entire plot and contour levels is consistent.  This seems true for the Nino3 SST data as well (contour values are different but image is same - using nonnormalized data mathces contour intervals much more closely)</p>

<p>When interpreting, pay attention to power/variance relationship.  Understand that the data has been normalized.  The CI of 95% is against rednoise (but power may still be significant against white noise and high value contours may still be interpreted as such)</p>

<h4>Analysis</h4>

<p>From the data with tides still existant diurnal and semidiurnal tides are dominant and occupy the largest component of the signal.   When looking at the detided data there is power at periods greater than 1 month (although not rednoise significant).  Significant bands appear at ~14 days and between 2-8 days (with more power in the winter months).  Using sfc pressure at one nearby point as my proxy (52.5, 190.0) I believe these bands are probably related to synoptic forcing.  A preliminary comparison using Reanalysis daily surface pressure as a proxy for storms provides the following wavelet analysis:</p>

<p><strong>Reanalysis</strong> sfc pressure anomalies</p>

<p><img src="images/normalizeddata/Reanalyisis_varcont_wave2.png" alt="Reanalysis_sfc_anom" width=100%></p>

<p><strong>Reanalysis</strong> 2-8 day scale averaged power (red) vs M6 2-8 day scale averaged power (black)</p>

<p><img src="images/normalizeddata/Reanalyisis_scaleave_comp.png" alt="Reanalysis_v_M6" width=100%></p>

<p>Preliminary correlation between the two using a scipy module <code>sp.stats.pearsonr(scale_ave1[0:-1:4], scale_ave2[130:474])</code> is .50</p>

<p>My guess is the 2-8 day band is somewhat synoptic and the 14-18 day band is tidal (M20 tide?).</p>

<h3>Todo:</h3>

<p>Completed: Calculate global wavelet significance and plot
Updated ChiSquare_Inverse test to use scipy package if desired</p>

<h5>Reference</h5>

<p>Although I did not use the Matlab/IDL/Fortran Code - I utilized it as a source thus:</p>

<ul>
<li><p>Notice: Please acknowledge the use of this software in any publications:</p>

<p>  'Wavelet software was provided by C. Torrence and G. Compo, and is available at URL: http://atoc.colorado.edu/research/wavelets/'. Please send a copy of such publications to either C. Torrence or G. Compo:</p></li>
</ul>


<h3>License</h3>

<p>The MIT License (MIT)</p>

<p>Copyright (c) 2013 Aaron O'Leary (dev@aaren.me)</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</body>
</html>